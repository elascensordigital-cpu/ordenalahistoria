<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Ordena la Historia</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#061227">
<link rel="icon" href="icon-192.png">

<style>
:root{
  --navy:#061227;
  --gold:#d6b25e;
  --gold2:#f0d79a;
  --line:rgba(214,178,94,.25);
  --text:#f5f1e6;
}
body{
  margin:0;
  font-family:system-ui, Arial;
  background:var(--navy);
  color:var(--text);
}

/* HEADER */
header{
  max-width:1000px;
  margin:auto;
  padding:12px;
  position:relative;
}
.header-img{
  width:100%;
  border-radius:12px;
  border:1px solid var(--line);
}
.papyrus{
  position:absolute;
  top:20px;
  right:24px;
  font-size:26px;
  cursor:pointer;
}

/* HOME */
.home{
  text-align:center;
  margin-top:20px;
}
.start-btn{
  margin-top:16px;
  padding:16px 26px;
  font-weight:900;
  border-radius:20px;
  border:1px solid var(--gold);
  background:rgba(214,178,94,.15);
  color:var(--gold2);
  cursor:pointer;
}

/* GAME */
main{
  max-width:800px;
  margin:20px auto;
  display:none;
}
.panel{
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
}
.panel-h{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.round-pill{
  border:1px solid var(--gold);
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}
.list{
  list-style:none;
  padding:0;
}
.card{
  border:1px solid var(--line);
  padding:10px;
  border-radius:12px;
  margin-bottom:8px;
  background:rgba(0,0,0,.2);
  cursor:grab;
}
.card.locked{ cursor:default; }

/* MODAL */
.backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal{
  background:#061227;
  border:1px solid var(--line);
  padding:16px;
  border-radius:16px;
  width:90%;
  max-width:500px;
}
button{ cursor:pointer; }
</style>
</head>

<body>

<header>
  <img src="cabecera.png" class="header-img">
  <div class="papyrus" id="btnSettings">ðŸ“œ</div>
</header>

<div class="home">
  <div>Arrastra los eventos para ordenarlos del mÃ¡s antiguo â†’ mÃ¡s reciente.</div>
  <button class="start-btn" id="btnStart">Â¡ORDENEMOS LA HISTORIA!</button>
</div>

<main id="game">
  <div class="panel">
    <div class="panel-h">
      <div id="whoLine">Turno: Solo</div>
      <div class="round-pill" id="roundPill">Ronda 1</div>
    </div>

    <ul id="cardList" class="list"></ul>

    <button id="btnCheck">Comprobar</button>
    <button id="btnNext">Siguiente</button>
  </div>
</main>

<!-- SETTINGS -->
<div class="backdrop" id="settings">
  <div class="modal">
    <h3>Ajustes</h3>

    <label>Modo</label>
    <select id="mode">
      <option value="solo">Solo</option>
      <option value="groups">Grupos</option>
    </select>

    <label>Rondas</label>
    <select id="rounds">
      <option>5</option>
      <option selected>8</option>
      <option>10</option>
    </select>

    <label>Grupos</label>
    <textarea id="groups"></textarea>

    <br><br>
    <button id="save">Guardar</button>
    <button id="close">Cerrar</button>
  </div>
</div>

<script>
/* ===== EVENTOS ===== */
const EVENTS = [
  {year:476,title:"CaÃ­da del Imperio romano de Occidente"},
  {year:1492,title:"Llegada de ColÃ³n a AmÃ©rica"},
  {year:1789,title:"RevoluciÃ³n francesa"},
  {year:1914,title:"Primera Guerra Mundial"},
  {year:1969,title:"Llegada a la Luna"},
  {year:1989,title:"CaÃ­da del Muro de BerlÃ­n"}
];

/* ===== ESTADO ===== */
let round=1;
let rounds=8;
let locked=false;
let current=[];

/* ===== UI ===== */
const game=document.getElementById("game");
const list=document.getElementById("cardList");

/* START */
document.getElementById("btnStart").onclick=()=>{
  game.style.display="block";
  startRound();
};

/* SETTINGS */
const settings=document.getElementById("settings");
document.getElementById("btnSettings").onclick=()=>settings.style.display="flex";
document.getElementById("close").onclick=()=>settings.style.display="none";
document.getElementById("save").onclick=()=>{
  rounds=parseInt(document.getElementById("rounds").value);
  settings.style.display="none";
};

/* RONDA */
function startRound(){
  locked=false;
  document.getElementById("roundPill").textContent=`Ronda ${round}/${rounds}`;

  current=[...EVENTS].sort(()=>Math.random()-.5).slice(0,5);
  list.innerHTML="";

  current.forEach(ev=>{
    const li=document.createElement("li");
    li.className="card";
    li.draggable=true;
    li.dataset.year=ev.year;
    li.innerHTML=`${ev.title}<div class="year"></div>`;
    addDrag(li);
    list.appendChild(li);
  });
}

/* DRAG */
let dragEl=null;
function addDrag(el){
  el.ondragstart=()=>dragEl=el;
  el.ondragover=e=>{
    e.preventDefault();
    if(el===dragEl)return;
    list.insertBefore(dragEl,el);
  };
}

/* CHECK */
document.getElementById("btnCheck").onclick=()=>{
  if(locked)return;
  locked=true;

  const cards=[...document.querySelectorAll(".card")];
  const sorted=[...cards].sort((a,b)=>a.dataset.year-b.dataset.year);

  cards.forEach((c,i)=>{
    const year=c.dataset.year;
    c.querySelector(".year").textContent="AÃ±o: "+year;
    if(c!==sorted[i]) c.style.borderColor="red";
    else c.style.borderColor="gold";
  });
};

/* NEXT */
document.getElementById("btnNext").onclick=()=>{
  round++;
  if(round>rounds){
    alert("Fin del juego");
    round=1;
  }
  startRound();
};

/* SERVICE WORKER */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
